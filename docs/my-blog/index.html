<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>H5 → 小程序消息通信 Demo1</title>
</head>

<body>
  <div style="padding:20px;">
    <h2>H5 页面（用于 Web-View）</h2>
    <button id="sendBtn" style="padding:10px 20px;font-size:16px;">发送消息给小程序</button>
  </div>

  <script>
    // 判断是否在小程序环境
    function isInMiniProgram() {
      return window.__wxjs_environment === 'miniprogram' 
          || /miniProgram/i.test(navigator.userAgent);
    }

    document.getElementById('sendBtn').addEventListener('click', function() {

      console.log("当前环境：", window.__wxjs_environment);
      console.log("wx:", window.wx);
      
      // 非小程序环境直接提示
      if (!isInMiniProgram() || !window.wx || !wx.miniProgram) {
        alert("当前不在小程序 Web-View 内，无法发送消息！");
        return;
      }

      wx.miniProgram.postMessage({
        data: {
          type: "openLocation",
          longitude: 116.397428,
          latitude: 39.90923,
          name: "天安门",
          address: "北京市东城区天安门",
          scale: 17
        }
      });

      alert("消息已发送！");
    });
  </script>

</body>
</html>
